
local objects={}
local mon

function init(monside)
	mon = peripheral.wrap(monside)
end

function clear()
	mon.setBackgroundColor(colors.black)
	mon.clear()
end

function redraw()
	clear()
	for k,o in pairs(objects) do
		if(o ~= nil) then
		o.draw()
		end
	end
end
function touchWait ()
event, touch, x, y = os.pullEvent("monitor_touch")
	for k,o in pairs(objects) do
		if(o ~= nil) then
			o.isClicked(x,y)
		end
	end
end


button = {}
function button.new (atext,acolor,ax,ay,acallback)
	local self = {}
	local callback=acallback
	local text = atext
	local color= acolor
	local x=ax
	local y=ay
	local key=0
	function self.isClicked(cx,cy)
		if(((cy >= y and cy <= y+2) and ( cx >= x and cx<= x+string.len (text)+2)))then
		local tcol=color
		color=colors.red
		self.draw()
		callback()
		sleep(0.1)
		color=tcol
		self.draw()
		end
	end
	function self.draw()
		mon.setBackgroundColor(color)
		
		mon.setCursorPos(x,y)
		mon.write(string.rep(" ",string.len (text)+2))
		
		mon.setCursorPos(x,y+1)
		mon.write(" "..text.." ")
		
		mon.setCursorPos(x,y+2)
		mon.write(string.rep(" ",string.len (text)+2))
	end
	
	function self.delete()
		objects[key]=nil
	end
	
	table.insert(objects,self)
	
	key= table.maxn(objects)
	
	return self
end

timeGraph = {}

function timeGraph.new(atitle,aposx,aposy,awidth,aheight,adataProvider,ainterval)
	local self= {}
	local values={}
	local title= atitle
	local posx=aposx
	local posy=aposy
	local width=awidth
	local height=aheight
	local dataProvider=adataProvider
	local interval = ainterval
	local key=0
	
	for k=1,width-2 do
		table.insert(values,0)
	end
	
	local function getmax()
		local max=0
		for k,v in pairs(values) do
			if v> max then max= v end
		end
		return max
	end
	
	local function addValue(v)
		table.insert(values,v)
		table.remove(values,1)
	end
	
	function self.run()
		while true do
			addValue(dataProvider())
			sleep(interval)
		end
	end
	
	function self.draw()
		local max = getmax()
		term.redirect(mon)
		paintutils.drawLine(posx,posy,posx+width,posy,colors.white)
		paintutils.drawLine(posx,posy+height,posx+width,posy+height,colors.white)
		paintutils.drawLine(posx,posy,posx,posy+height,colors.white)
		paintutils.drawLine(posx+width,posy,posx+width,posy+height,colors.white)
		sleep(1)
		term.restore()
		mon.setCursorPos(posx+math.floor((width-string.len(title))/2),posy)
		mon.setBackgroundColor(colors.white)
		mon.setTextColor(colors.black)
		mon.write(title)
		if max>0 then
		term.redirect(mon)
			for k,v in pairs(values) do
				local gy=math.floor(v/max*(hieght-2))
				paintutils.drawPixel(posx+k,posy+1-gy,colors.lime)
			end
		term.restore()
		end
	end
	function self.isClicked(cx,cy)
		--if(((cy >= y and cy <= y+2) and ( cx >= x and cx<= x+string.len (text)+2)))then
		--callback()
		--end
	end
	
	function self.delete()
		objects[key]=nil
	end
	
	table.insert(objects,self)
	
	key= table.maxn(objects)
	
	return self
end

--local b = button.new ("right","test",colors.green,2,2)
--b.draw()